## redis事务

可以一次执行多个命令，本质是一组命令的集合。一个事务中的，所有命令都会序列化，按顺序地串行化执行而不会被其它命令插入，不许加塞

一个队列中，一次性、顺序性、排他性的执行一系列命令







常用命令

- discard   取消事务
- exec 执行事务
- multi 标记事务块的开始
- unwatch 取消watch命令对key的监视
- watch  监视一个（或者多个）key，如果在事务执行之前这个key被其他命令改动，那么事务被打断，类似 乐观锁







#### 如何使用redis事务

1. 开启：以MULTI开始一个事务

2. 入队：将多个命令入队到事务中，接到这些命令并不会立即执行，而是放到等待执行的事务队列里面

2. 执行：由EXEC命令触发事务，或者discard 取消事务



#### watch的使用

1. watch  key
2.  multi 开始事务
3. exec 提交事务，如果key被修改了  则 事务执行失败

 

1. Watch指令，类似乐观锁，事务提交时，如果Key的值已被别的客户端改变，比如某个list已被别的客户端push/pop过了，整个事务队列都不会被执行

2. 通过WATCH命令在事务执行之前监控了多个Keys，倘若在WATCH之后有任何Key的值发生了变化，EXEC命令执行的事务都将被放弃，同时返回Nullmulti-bulk应答以通知调用者事务执行失败



#### 乐观锁

 乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量，乐观锁策略:提交版本必须大于记录当前版本才能执行更新	

#### 悲观锁

​	 悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁









## redis 订阅

进程间的一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。